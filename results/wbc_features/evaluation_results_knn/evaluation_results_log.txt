WBC Classification Evaluation (with Precision, Recall, F1)
Started at: 2025-12-21 23:40:43
============================================================
Loaded 411 labels from CSV
Columns: ['Unnamed: 0', 'Image', 'Category']
Sample data:
   Unnamed: 0  Image    Category
0         NaN      0  NEUTROPHIL
1         NaN      1  NEUTROPHIL
2         NaN      2  NEUTROPHIL
3         NaN      3  NEUTROPHIL
4         NaN      4  NEUTROPHIL

Evaluating all images...
============================================================
Processed 50/411 images...
Processed 100/411 images...
Processed 150/411 images...
Processed 200/411 images...
Processed 250/411 images...
Processed 300/411 images...
Processed 350/411 images...
Processed 400/411 images...

Completed processing 411 images.

================================================================================
EVALUATION REPORT
================================================================================

üìä OVERALL METRICS
--------------------------------------------------------------------------------
Overall Accuracy: 72.62%
Correct: 236/325

üìà MACRO-AVERAGED METRICS (Unweighted Average Across Classes)
--------------------------------------------------------------------------------
Macro Precision:  55.25%
Macro Recall:     45.88%
Macro F1-Score:   45.94%

‚öñÔ∏è  WEIGHTED-AVERAGED METRICS (Weighted by Support)
--------------------------------------------------------------------------------
Weighted Precision:  70.79%
Weighted Recall:     72.62%
Weighted F1-Score:   69.80%

üéØ PER-CLASS DETAILED METRICS
--------------------------------------------------------------------------------
Class            Precision     Recall   F1-Score    Support
--------------------------------------------------------------------------------
BASOPHIL             0.00%      0.00%      0.00%          2
EOSINOPHIL          59.32%     46.05%     51.85%         76
LYMPHOCYTE          74.36%     85.29%     79.45%         34
MONOCYTE            66.67%      9.52%     16.67%         21
NEUTROPHIL          75.89%     88.54%     81.73%        192

================================================================================
METRIC DEFINITIONS:
--------------------------------------------------------------------------------
‚Ä¢ Precision:  Of all predicted as this class, % that were correct
              (Answers: 'When we say X, are we usually right?')
‚Ä¢ Recall:     Of all actual instances of this class, % we found
              (Answers: 'Do we catch most X cases?')
‚Ä¢ F1-Score:   Harmonic mean of Precision and Recall
              (Balanced measure of both)
‚Ä¢ Support:    Total number of actual instances in dataset
================================================================================

üìã Processing Status:
--------------------------------------------------------------------------------
  correct                  :  236
  image_not_found          :   47
  incorrect                :   89
  no_ground_truth          :    1
  no_wbc_detected          :   38

================================================================================

============================================================
MISCLASSIFICATION ANALYSIS
============================================================

Common Misclassification Patterns:
------------------------------------------------------------
  EOSINOPHIL ‚Üí NEUTROPHIL       :  39 cases
  NEUTROPHIL ‚Üí EOSINOPHIL       :  18 cases
  MONOCYTE ‚Üí NEUTROPHIL         :  11 cases
  MONOCYTE ‚Üí EOSINOPHIL         :   5 cases
    Images: [225, 278, 323, 335, 342]
  NEUTROPHIL ‚Üí LYMPHOCYTE       :   4 cases
    Images: [34, 91, 198, 212]
  MONOCYTE ‚Üí LYMPHOCYTE         :   3 cases
    Images: [40, 83, 127]
  LYMPHOCYTE ‚Üí NEUTROPHIL       :   3 cases
    Images: [134, 148, 347]
  EOSINOPHIL ‚Üí LYMPHOCYTE       :   2 cases
    Images: [41, 88]
  BASOPHIL ‚Üí NEUTROPHIL         :   1 cases
    Images: [8]
  BASOPHIL ‚Üí LYMPHOCYTE         :   1 cases
    Images: [132]
  LYMPHOCYTE ‚Üí MONOCYTE         :   1 cases
    Images: [283]
  LYMPHOCYTE ‚Üí EOSINOPHIL       :   1 cases
    Images: [356]

============================================================
THRESHOLD ADJUSTMENT SUGGESTIONS
============================================================

NEUTROPHIL:
----------------------------------------
  Sample count: 192

  Feature Statistics:
    Circularity:      0.350 ¬± 0.169 (range: 0.092 - 0.782)
    Solidity:         0.732 ¬± 0.131 (range: 0.383 - 0.965)
    Num Lobes:        2.1 ¬± 1.4 (range: 1 - 8)
    CN Ratio:         2.559 ¬± 0.882 (range: 0.981 - 5.589)
    Mean Hue:         114.4 ¬± 19.0 (range: 55.2 - 145.6)
    Texture Variance: 64.4 ¬± 11.2

  Classification accuracy for this type: 88.5% (170/192)
  Often misclassified as: {'EOSINOPHIL': np.int64(18), 'LYMPHOCYTE': np.int64(4)}

BASOPHIL:
----------------------------------------
  Sample count: 2

  Feature Statistics:
    Circularity:      0.548 ¬± 0.142 (range: 0.448 - 0.649)
    Solidity:         0.887 ¬± 0.057 (range: 0.846 - 0.927)
    Num Lobes:        2.0 ¬± 0.0 (range: 2 - 2)
    CN Ratio:         1.111 ¬± 0.172 (range: 0.990 - 1.232)
    Mean Hue:         91.2 ¬± 18.4 (range: 78.2 - 104.1)
    Texture Variance: 54.7 ¬± 8.5

  Classification accuracy for this type: 0.0% (0/2)
  Often misclassified as: {'NEUTROPHIL': np.int64(1), 'LYMPHOCYTE': np.int64(1)}

EOSINOPHIL:
----------------------------------------
  Sample count: 76

  Feature Statistics:
    Circularity:      0.380 ¬± 0.156 (range: 0.093 - 0.758)
    Solidity:         0.756 ¬± 0.115 (range: 0.411 - 0.949)
    Num Lobes:        1.6 ¬± 1.2 (range: 1 - 7)
    CN Ratio:         1.849 ¬± 0.538 (range: 0.849 - 3.505)
    Mean Hue:         96.7 ¬± 19.0 (range: 48.7 - 145.8)
    Texture Variance: 56.1 ¬± 10.1

  Classification accuracy for this type: 46.1% (35/76)
  Often misclassified as: {'NEUTROPHIL': np.int64(39), 'LYMPHOCYTE': np.int64(2)}

MONOCYTE:
----------------------------------------
  Sample count: 21

  Feature Statistics:
    Circularity:      0.265 ¬± 0.179 (range: 0.039 - 0.689)
    Solidity:         0.651 ¬± 0.167 (range: 0.420 - 0.941)
    Num Lobes:        4.0 ¬± 4.0 (range: 1 - 20)
    CN Ratio:         2.360 ¬± 1.396 (range: 0.538 - 5.582)
    Mean Hue:         87.8 ¬± 20.6 (range: 51.7 - 128.0)
    Texture Variance: 56.0 ¬± 13.6

  Classification accuracy for this type: 9.5% (2/21)
  Often misclassified as: {'NEUTROPHIL': np.int64(11), 'EOSINOPHIL': np.int64(5), 'LYMPHOCYTE': np.int64(3)}

LYMPHOCYTE:
----------------------------------------
  Sample count: 34

  Feature Statistics:
    Circularity:      0.667 ¬± 0.202 (range: 0.067 - 0.822)
    Solidity:         0.897 ¬± 0.154 (range: 0.326 - 0.978)
    Num Lobes:        1.4 ¬± 1.5 (range: 1 - 9)
    CN Ratio:         1.582 ¬± 0.496 (range: 0.907 - 3.087)
    Mean Hue:         65.4 ¬± 12.6 (range: 38.8 - 96.8)
    Texture Variance: 46.1 ¬± 4.4

  Classification accuracy for this type: 85.3% (29/34)
  Often misclassified as: {'NEUTROPHIL': np.int64(3), 'MONOCYTE': np.int64(1), 'EOSINOPHIL': np.int64(1)}

Confusion matrix saved to ../results/wbc_features/evaluation_results_knn/confusion_matrix.png
Feature distributions saved to ../results/wbc_features/evaluation_results_knn/feature_distributions.png

Detailed results exported to ../results/wbc_features/evaluation_results_knn/wbc_table.csv

Detailed metrics exported to ../results/wbc_features/evaluation_results_knn/detailed_metrics.csv

============================================================
Evaluation complete!
Finished at: 2025-12-21 23:40:49
Log file saved to: ../results/wbc_features/evaluation_results_knn/evaluation_results_log.txt
============================================================
